<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><meta name="google-site-verification" content="K7thEgdLm0UfRWJ5MGdF7sCcjClSzAlxFLPv2Oz5CGM"><title> 오픈소스 Grafana와 InfluxDB를 활용한 서버 모니터링 · JingyuJung's Blog</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="오픈소스 Grafana와 InfluxDB를 활용한 서버 모니터링 - Jingyu Jung"><meta name="keywords"><meta name="author" content="Jingyu Jung"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="http://monibu1548.github.io/atom.xml" title="JingyuJung's Blog"></head><body><header><div class="header row"> <a href="/" class="logo-link"><img src="/images/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="POSTS" class="nav-list-link">POSTS</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="ARCHIVES" class="nav-list-link">ARCHIVES</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">오픈소스 Grafana와 InfluxDB를 활용한 서버 모니터링</h1><div class="post-info">2017-03-03<p class="visit"><i data-hk-page="current">-</i><span>읽음</span></p></div><div class="post-content"><p><img src="../../../../images/grafana/title.jpg" alt=""></p>
<h1 id="오픈소스-Grafana와-InfluxDB를-활용한-서버-모니터링"><a href="#오픈소스-Grafana와-InfluxDB를-활용한-서버-모니터링" class="headerlink" title="오픈소스 Grafana와 InfluxDB를 활용한 서버 모니터링"></a>오픈소스 Grafana와 InfluxDB를 활용한 서버 모니터링</h1><h2 id="왜-쓰는가"><a href="#왜-쓰는가" class="headerlink" title="왜 쓰는가?"></a>왜 쓰는가?</h2><p>서버의 리소스 (CPU 사용량 및 메모리 사용량)이나 웹 사이트 URL의 호출 횟수, 응답시간 등 서버 개발자가 실시간 모니터링해야 하는 자원을 쉽게 모아서 실시간으로 보여줄 수 있다.</p>
<p>간단한 사용 후기로는 Grafana가 그래프를 그려주는게 InfluxDB에 있는 데이터를 가져와서 그려준다. 그릴 데이터를 sql 쿼리로 가져온다. 신기하다!! 물론 DB는 InfluxDB외에도 다른 Plugin을 통해 가져올 수 있다.</p>
<h2 id="Grafana는"><a href="#Grafana는" class="headerlink" title="Grafana는?"></a>Grafana는?</h2><p>서버 모니터링 대시보드 오픈소스. 이런식으로 그려준다.!</p>
<p><img src="../../../../images/grafana/ex.jpg" alt=""></p>
<p>얼마나 아름다운가!</p>
<p>시간대 별로. DB에서 사용자 쿼리에 의해 얻어진 데이터로 자동으로 그려준다.</p>
<p>Go와 Nodejs 디펜던시를 갖고있다.</p>
<h2 id="InfluxDB는"><a href="#InfluxDB는" class="headerlink" title="InfluxDB는?"></a>InfluxDB는?</h2><p>시계열(Time-series) DB. 시계열 데이터란 시간의 흐름에 따라 저장하는 데이터로 서버 환경에서 각종 지표를 수집하는 목적으로 사용한다. http protocol을 이용해 외부에서 제어도 가능하며 표준 SQL을 통해 데이터를 다룰 수 있다.</p>
<h1 id="시작은-설치로부터"><a href="#시작은-설치로부터" class="headerlink" title="시작은 설치로부터!"></a>시작은 설치로부터!</h1><h2 id="Grafana-설치"><a href="#Grafana-설치" class="headerlink" title="Grafana 설치"></a>Grafana 설치</h2><ul>
<li>centos6 기준으로 설치한 내용입니다. 모든 설치는 패키지를 사용하지 않고 portable로 진행합니다.</li>
</ul>
<h3 id="Go-디펜던시-설치"><a href="#Go-디펜던시-설치" class="headerlink" title="Go 디펜던시 설치"></a>Go 디펜던시 설치</h3><p>go 다운로드 페이지</p>
<p><a href="https://golang.org/dl/" target="_blank" rel="noopener">https://golang.org/dl/</a></p>
<p>서버환경에 맞는 tar.gz 파일을 받고 tar로 압축을 해제한다.</p>
<p>GOPATH와 GOROOT 환경변수를 설정해야합니다.</p>
<p>GOPATH는 GO에서 받는 데이터를 보관할 장소. ~/grafana 를 만들고 이곳으로 설정했습니다.</p>
<p>GOROOT는 다운받은 go의 홈디렉토리입니다.</p>
<p>/.bashrc 에 다음과 같은 내용을 추가합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">export</span> GOPATH=<span class="string">'/&#123;home&#125;/&#123;username&#125;/grafana'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> GOROOT=<span class="string">'/&#123;다운 받은 go 위치&#125;'</span></span><br></pre></td></tr></table></figure>
<p>그리고 수정한 .bashrc를 적용합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">source</span> .bashrc</span><br></pre></td></tr></table></figure>
<p>그 후 grafana source 를 다운로드합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">go get github.com/grafana/grafana</span><br></pre></td></tr></table></figure>
<p>그러면 $GOPATH에 grafana 디렉토리가 생긴 것을 볼 수 있습니다.</p>
<p>이어서 grafana를 설치하기 전에 nodejs를 설치합니다.</p>
<h3 id="nodejs-디펜던시-설치"><a href="#nodejs-디펜던시-설치" class="headerlink" title="nodejs 디펜던시 설치"></a>nodejs 디펜던시 설치</h3><p> <a href="https://nodejs.org/download/" target="_blank" rel="noopener">https://nodejs.org/download/</a></p>
<p> 위 링크에서 nodejs를 다운받습니다. 최신 버전도 많이 나왔지만 저는 4.7사용.. 서버도 옛날꺼고..파이썬도 옛날거고…. node만 최신이면 꼬일것 같은 기분!</p>
<p> node도 환경변수로 등록해서 터미널에서 node를 입력했을 때 node 가 바로 실행되어야 합니다.</p>
<h3 id="이제-진짜-grafana-설치"><a href="#이제-진짜-grafana-설치" class="headerlink" title="이제 진짜 grafana 설치"></a>이제 진짜 grafana 설치</h3><p> 일단 go를 이용해 grafana를 받은 위치로 이동하고 설치를 시작합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$GOPATH</span>/src/github.com/grafana/grafana</span><br><span class="line"></span><br><span class="line">go run build.go setup</span><br><span class="line"></span><br><span class="line">go run build.go build</span><br></pre></td></tr></table></figure>
<p>이제 여기까지 grafana의 설치가 끝났습니다!!!는 Back-end만.. 이대로 실행하면 Front-end 와장창</p>
<p>이제 grunt로 Front-end를 가져옵니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">npm install -g yarn</span><br><span class="line"></span><br><span class="line">yarn install --pure-lockfile</span><br><span class="line"></span><br><span class="line">npm install -g grunt-cli</span><br><span class="line"></span><br><span class="line">grunt</span><br></pre></td></tr></table></figure>
<p>이제 진짜 설치 끝!!!</p>
<p>grafana 디렉토리의 ./bin/grafana-server 를 실행시킵니다.</p>
<p>그러면 기본적으로 3000번 포트로 구동되며. <a href="http://localhost:3000" target="_blank" rel="noopener">http://localhost:3000</a> 로 접근해서 확인할 수 있습니다. 일단 다른 프로그램이 3000번을 잡고있으면 안된다!</p>
<p><strong> 정말 설치만 하고 실행했다. 설정파일을 통해 admin 계정 등 보안을 위해 많은 설정이 필요하다 </strong></p>
<h3 id="InfluxDB-설치"><a href="#InfluxDB-설치" class="headerlink" title="InfluxDB 설치"></a>InfluxDB 설치</h3><p>이제 데이터를 예쁘게 그려줄 대쉬보드를 설치했으니 데이터를 저장할 DB를 설치해야한다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">wget https://dl.influxdata.com/influxdb/releases/influxdb-1.2.0_linux_amd64.tar.gz</span><br><span class="line">tar xvfz influxdb-1.2.0_linux_amd64.tar.gz</span><br></pre></td></tr></table></figure>
<p>2017-03-03일 기준이므로</p>
<p><a href="https://portal.influxdata.com/downloads#influxdb" target="_blank" rel="noopener">https://portal.influxdata.com/downloads#influxdb</a></p>
<p>에서 최신버전을 확인하고 설치하는 것을 추천. Standalone 으로!!!!</p>
<p>다운로드가 완료되면 influxdb 하위 ./usr/bin 의 influxd를 실행한다</p>
<p>influxd 가 influxDB 데몬이며 influx 는 influxDB 의 cli 클라이언트다.</p>
<h2 id="Grafana와-InfluxDB-연동하기"><a href="#Grafana와-InfluxDB-연동하기" class="headerlink" title="Grafana와 InfluxDB 연동하기"></a>Grafana와 InfluxDB 연동하기</h2><p>가장 어려운 부분이었다.</p>
<p>Grafana 페이지. localhost:3000 에서 설정한다. 로그인을 해야한다면 기본 id는 admin, 기본 pw도 admin 이다.</p>
<p>이제 Grafana 페이지의 DataSource메뉴에서 InfluxDB를 연결한다.</p>
<p>ip와 포트를 연결하고 Save&amp;Test 버튼을 누른다. 연결이 되었는지 안되었는지는 알려준다!!</p>
<p>초록불이 뜰때까지 정보들을 맞게 수정한다!!</p>
<h2 id="Grafana에서-그래프-그리기"><a href="#Grafana에서-그래프-그리기" class="headerlink" title="Grafana에서 그래프 그리기"></a>Grafana에서 그래프 그리기</h2><p>쉽다.</p>
<ul>
<li>Dashboard 추가.</li>
<li>그래프 추가</li>
<li>각 축에 쿼리문 작성</li>
</ul>
<p>TIP. add query로 쿼리 추가해서 막 블록형태로 쿼리를 만든다.. 이거 쓰지말자.. 잘 안된다.<br>쿼리 쓰는데 옆에보면 햄버거 버튼이 있다. Toggle custom query를 통해 직접 query를 작성하자.</p>
<p>이렇게 해서 나온 내 서비스의 모니터링 페이지!!</p>
<p><img src="../../../../images/grafana/result.PNG" alt=""></p>
<h2 id="후기"><a href="#후기" class="headerlink" title="후기"></a>후기</h2><p>Grafana와 InfluxDB를 설치하고 그래프를 그리기까지 2~3일 삽질은 해야하지 않을까 생각했었다. 둘 다 처음사용해보는데다가 디펜던시가 몇가지 있어서 어디선가 터질꺼라 생각했다..! But 설치까지는 1시간만에 끝나버렸다..</p>
<p>문제는 설치보다 grafana 대시보드 구성과 시계열 데이터에 대한 이해! sql 을 이용해 그래프를 그린다는게 생각하기 힘들었다. 또 시계열 데이터를 어떻게 그려야 원하는 그래프가 나오는지 어렵다 ㅠㅜ.</p>
<p>grafana에 아쉬운점은 그래프 Scale 을 조절하기 힘들다는 것! 마우스를 이용해 끄적끄적하면 그래프도 좌우로 이동되고 Zoom in out도 되면 좋겠다!!!!</p>
<p>있는 기능인데 발견을 못한 것일수도!</p>
<p>좀 더 능숙하게 쓸 수 있도록 이것저것 해봐야겠다</p>
</div></article></div><div class="right-container"><div class="widget"><div class="category"><h4>카테고리</h4><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NHN-ent/">NHN ent.</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Spring-Framework/">Spring Framework</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/생산성/">생산성</a><span class="category-list-count">2</span></li></ul></div></div><div class="widget"><div class="tagcloud"><h4>태그</h4><a href="/tags/CI/" style="font-size: 10px;">CI</a> <a href="/tags/Dooray/" style="font-size: 10px;">Dooray</a> <a href="/tags/Jasypt/" style="font-size: 10px;">Jasypt</a> <a href="/tags/NHN/" style="font-size: 13.33px;">NHN</a> <a href="/tags/Spring-Framework/" style="font-size: 20px;">Spring Framework</a> <a href="/tags/Web/" style="font-size: 16.67px;">Web</a> <a href="/tags/grafana/" style="font-size: 10px;">grafana</a> <a href="/tags/influxDB/" style="font-size: 10px;">influxDB</a> <a href="/tags/java/" style="font-size: 13.33px;">java</a> <a href="/tags/jenkins/" style="font-size: 10px;">jenkins</a> <a href="/tags/maven/" style="font-size: 10px;">maven</a> <a href="/tags/기술교육/" style="font-size: 10px;">기술교육</a> <a href="/tags/모니터링/" style="font-size: 10px;">모니터링</a> <a href="/tags/배포/" style="font-size: 10px;">배포</a> <a href="/tags/버전-관리/" style="font-size: 10px;">버전 관리</a> <a href="/tags/성능-튜닝/" style="font-size: 10px;">성능 튜닝</a> <a href="/tags/스프링-프레임워크/" style="font-size: 20px;">스프링 프레임워크</a> <a href="/tags/웹/" style="font-size: 16.67px;">웹</a> <a href="/tags/최적화/" style="font-size: 13.33px;">최적화</a> <a href="/tags/쿼리스트링/" style="font-size: 10px;">쿼리스트링</a> <a href="/tags/토스트루키/" style="font-size: 10px;">토스트루키</a></div></div><div class="widget"><div class="recent"><h4>최근 포스트</h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/03/29/dooray/">NHNent가 만든 협업 서비스 Dooray</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/10/web-optimize-3/">웹 js, css 정적 파일 버전관리 방법</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/05/javatuning/">자바 성능 튜닝 이야기</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/03/grafana/">오픈소스 Grafana와 InfluxDB를 활용한 서버 모니터링</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/03/01/web-optimize-2/">웹 최적화 (Apache mod_deflate 모듈을 이용한 압축 전송)</a></li></ul></div></div><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">검색</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2017/03/05/javatuning/" class="prev">PREV</a><a href="/2017/03/01/web-optimize-2/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'jingyujung';
var disqus_identifier = '2017/03/03/grafana/';
var disqus_title = '오픈소스 Grafana와 InfluxDB를 활용한 서버 모니터링';
var disqus_url = 'http://monibu1548.github.io/2017/03/03/grafana/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//jingyujung.disqus.com/count.js" async></script><div class="copyright"><p>© 2017 - 2018 <a target="_blank">Jingyu Jung</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a></p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="http://apps.bdimg.com/libs/jquery/1.8.2/jquery.min.js"></script><script src="https://cdn1.lncld.net/static/js/av-mini-0.6.10.js"></script><script src="/scripts/hit-kounter-lc-0.2.0.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-117570529-1",'auto');ga('send','pageview');</script><script src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({google_ad_client: "ca-pub-5848720540760149",enable_page_level_ads: true});</script></body></html>